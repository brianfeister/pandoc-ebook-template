\documentclass[12pt]{report}

\usepackage[
  letterpaper,
  margin=0.5in,
  twocolumn,
]{geometry}

% General spacing settings

%\usepackage{setspace}
%\setstretch{}

%\setlength{\parindent}{0pt}
%\setlength{\parskip}{6pt plus 2pt minus 1pt}
%\setlength{\emergencystretch}{3em}  % prevent overfull lines

% IMPORTANT: remember to use this if lists are present
%\providecommand{\tightlist}{%
%  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Math extensions

%\usepackage{amssymb,amsmath}

% Font selection

\usepackage{fontspec}
\setmainfont{Droid Serif}
\setsansfont{Alegreya SC}
\setmonofont{Alegreya SC}

% Hyperlinks

\usepackage[
  unicode=true
]{hyperref}

\hypersetup{
  % this will need a bit of cleanup
  breaklinks=true,
  bookmarks=true,
  pdfauthor={$author-meta$},
  pdftitle={$title-meta$},
  colorlinks=true,
  citecolor=$if(citecolor)$$citecolor$$else$blue$endif$,
  urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
  linkcolor=$if(linkcolor)$$linkcolor$$else$magenta$endif$,
  pdfborder={0 0 0},
}

% don't use monospace font for urls
\urlstyle{same}

% Page headers/footers

\usepackage{fancyhdr}
\pagestyle{fancy}
\pagenumbering{arabic}
\lhead{\itshape $title$}
\chead{}
\rhead{\itshape{\nouppercase{\leftmark}}}
\lfoot{v $version$}
\cfoot{}
\rfoot{\thepage}

% Language selection

\usepackage{polyglossia}
\setmainlanguage{english}

% Table packages

\usepackage{multicol,booktabs,xtab}
\let\endhead\relax

% Graphics

%$if(graphics)$
%\usepackage{graphicx,grffile}
%\newsavebox\ltmcbox
%\makeatletter
%\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
%\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
%\makeatother
%% Scale images if necessary, so that they will not overflow the page
%% margins by default, and it is still possible to overwrite the defaults
%% using explicit options in \includegraphics[width, height, ...]{}
%\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
%$endif$

% Ugly paragraph hack

%\ifx\paragraph\undefined\else
%\let\oldparagraph\paragraph
%\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
%\fi
%\ifx\subparagraph\undefined\else
%\let\oldsubparagraph\subparagraph
%\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
%\fi

% Background image

\usepackage{eso-pic}
\usepackage{tikz}
\usetikzlibrary{positioning}

\AddToShipoutPicture{
%\tikz [overlay, remember picture] \node at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{assets/paper-bg.jpg}};
}

% Microtype

\usepackage{microtype}

% Main document

$if(title)$
\title{$title$$if(subtitle)$\\\vspace{0.5em}{\large $subtitle$}$endif$}
$endif$

$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$

\date{$date$}

% TODO: sloppiness *must* be removed in production
\sloppy

\begin{document}
\maketitle
{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{2}
\tableofcontents
}
%\listoftables
%\listoffigures
$body$
\end{document}
